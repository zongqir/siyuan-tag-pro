# æ–°ç›®å½•ç»“æ„è¯´æ˜

## âœ… é‡æ„å®Œæˆï¼

ç›®å½•ç»“æ„å·²æŒ‰ä¸šåŠ¡æ¨¡å—é‡æ–°ç»„ç»‡ï¼Œæ”¹åŠ¨å½±å“é¢æœ€å°ã€‚

---

## ğŸ“ æ–°ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ shared/                    # ğŸ”§ å…±äº«ä»£ç ï¼ˆé€šç”¨ã€å¯å¤ç”¨ï¼‰
â”‚   â”œâ”€â”€ api/                   # API å°è£…
â”‚   â”‚   â””â”€â”€ index.ts          # æ€æºç¬”è®° API
â”‚   â”œâ”€â”€ components/            # é€šç”¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ SiyuanTheme/      # æ€æºä¸»é¢˜ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ SyButton.vue
â”‚   â”‚       â”œâ”€â”€ SyCheckbox.vue
â”‚   â”‚       â”œâ”€â”€ SyIcon.vue
â”‚   â”‚       â”œâ”€â”€ SyInput.vue
â”‚   â”‚       â”œâ”€â”€ SySelect.vue
â”‚   â”‚       â””â”€â”€ SyTextarea.vue
â”‚   â”œâ”€â”€ types/                 # é€šç”¨ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ api.d.ts          # API ç±»å‹
â”‚   â”‚   â””â”€â”€ index.d.ts        # å…¨å±€ç±»å‹
â”‚   â”œâ”€â”€ utils/                 # é€šç”¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ logger.ts         # æ—¥å¿—å·¥å…·
â”‚   â”‚   â””â”€â”€ index.ts          # å…¶ä»–å·¥å…·
â”‚   â””â”€â”€ i18n/                  # å›½é™…åŒ–
â”‚       â”œâ”€â”€ en_US.json
â”‚       â””â”€â”€ zh_CN.json
â”‚
â”œâ”€â”€ modules/                   # ğŸ“¦ ä¸šåŠ¡æ¨¡å—ï¼ˆåŠŸèƒ½ç‰¹æ€§ï¼‰
â”‚   â””â”€â”€ tag/                   # æ ‡ç­¾æ¨¡å—
â”‚       â”œâ”€â”€ core/              # æ ¸å¿ƒé€»è¾‘
â”‚       â”‚   â”œâ”€â”€ EventManager.ts
â”‚       â”‚   â”œâ”€â”€ DocumentStateManager.ts
â”‚       â”‚   â”œâ”€â”€ TagManager.ts
â”‚       â”‚   â”œâ”€â”€ TagClickManager.ts
â”‚       â”‚   â”œâ”€â”€ TagSearch.ts
â”‚       â”‚   â””â”€â”€ TagRenderer.ts
â”‚       â”œâ”€â”€ ui/                # UI ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ TagDialog.ts
â”‚       â”‚   â”œâ”€â”€ TagEventHandler.ts
â”‚       â”‚   â””â”€â”€ TagSearchPanel.ts
â”‚       â”œâ”€â”€ utils/             # æ¨¡å—ä¸“ç”¨å·¥å…·
â”‚       â”‚   â”œâ”€â”€ dom.ts
â”‚       â”‚   â”œâ”€â”€ format.ts
â”‚       â”‚   â””â”€â”€ helpers.ts
â”‚       â”œâ”€â”€ types/             # æ¨¡å—ä¸“ç”¨ç±»å‹
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â”œâ”€â”€ constants/         # å¸¸é‡
â”‚       â”‚   â””â”€â”€ presetTags.ts
â”‚       â”œâ”€â”€ styles/            # æ ·å¼
â”‚       â”‚   â””â”€â”€ index.scss
â”‚       â”œâ”€â”€ index.ts           # æ¨¡å—å¯¼å‡º
â”‚       â””â”€â”€ README.md          # æ¨¡å—æ–‡æ¡£
â”‚
â”œâ”€â”€ App.vue                    # åº”ç”¨å…¥å£ç»„ä»¶
â”œâ”€â”€ main.ts                    # ä¸»é€»è¾‘
â”œâ”€â”€ index.ts                   # æ’ä»¶å…¥å£
â”œâ”€â”€ index.scss                 # å…¨å±€æ ·å¼
â””â”€â”€ shims-vue.d.ts            # Vue ç±»å‹å£°æ˜
```

---

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. Sharedï¼ˆå…±äº«ï¼‰vs Modulesï¼ˆæ¨¡å—ï¼‰

| ç±»åˆ« | ç”¨é€” | ç‰¹ç‚¹ |
|------|------|------|
| **shared/** | é€šç”¨ä»£ç  | âœ… å¯è¢«ä»»ä½•æ¨¡å—ä½¿ç”¨<br>âœ… æ— ä¸šåŠ¡é€»è¾‘<br>âœ… é«˜åº¦å¯å¤ç”¨ |
| **modules/** | ä¸šåŠ¡åŠŸèƒ½ | âœ… ç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—<br>âœ… åŒ…å«ä¸šåŠ¡é€»è¾‘<br>âœ… å¯ç‹¬ç«‹å¼€å‘æµ‹è¯• |

### 2. è·¯å¾„åˆ«å

```typescript
// vite.config.ts å’Œ tsconfig.json ä¸­é…ç½®ï¼š
{
  "@": "src",              // æ ¹ç›®å½•
  "@shared": "src/shared", // å…±äº«ä»£ç 
  "@modules": "src/modules" // ä¸šåŠ¡æ¨¡å—
}
```

### 3. å¼•ç”¨æ–¹å¼

```typescript
// âœ… ä½¿ç”¨è·¯å¾„åˆ«åï¼ˆæ¨èï¼‰
import Logger from '@shared/utils/logger'
import { TagManager } from '@modules/tag'

// âœ… æ¨¡å—å†…ä½¿ç”¨ç›¸å¯¹è·¯å¾„
import { TagDialog } from '../ui/TagDialog'
```

---

## ğŸ“Š æ”¹åŠ¨å½±å“åˆ†æ

### æ”¹åŠ¨çš„æ–‡ä»¶

| æ”¹åŠ¨ç±»å‹ | æ–‡ä»¶æ•° | é£é™©ç­‰çº§ |
|---------|--------|---------|
| ç§»åŠ¨æ–‡ä»¶ | 16 ä¸ª | ä½ |
| æ›´æ–° import è·¯å¾„ | 12 ä¸ª | ä½ |
| æ›´æ–°é…ç½®æ–‡ä»¶ | 2 ä¸ª | ä½ |
| **æ€»è®¡** | **30 ä¸ª** | **ä½** |

### æœªæ”¹åŠ¨çš„å†…å®¹

âœ… **ä¸šåŠ¡é€»è¾‘å®Œå…¨æœªåŠ¨** - æ‰€æœ‰ä»£ç é€»è¾‘ä¿æŒä¸å˜  
âœ… **tag æ¨¡å—å†…éƒ¨ç»“æ„æœªåŠ¨** - core/ã€ui/ã€utils/ å®Œæ•´ä¿ç•™  
âœ… **åŠŸèƒ½å®Œå…¨ä¸€è‡´** - 0 åŠŸèƒ½å›é€€  

---

## ğŸš€ ä¼˜åŠ¿

### 1. èŒè´£æ¸…æ™°
```
shared/    â†’ æˆ‘æ˜¯å·¥å…·äººï¼Œè°éƒ½å¯ä»¥ç”¨æˆ‘
modules/   â†’ æˆ‘æ˜¯ä¸šåŠ¡æ¨¡å—ï¼Œä¸“æ³¨åšä¸€ä»¶äº‹
```

### 2. æ˜“äºæ‰©å±•
```typescript
// æ–°å¢åŠŸèƒ½æ¨¡å—è¶…ç®€å•ï¼š
src/modules/
  â””â”€â”€ tag/         âœ… å·²æœ‰
  â””â”€â”€ search/      â• æ–°å¢æœç´¢åŠŸèƒ½
  â””â”€â”€ export/      â• æ–°å¢å¯¼å‡ºåŠŸèƒ½
  â””â”€â”€ sync/        â• æ–°å¢åŒæ­¥åŠŸèƒ½
```

### 3. ä¾¿äºç»´æŠ¤
```
- é€šç”¨ä»£ç ç»Ÿä¸€ç®¡ç†åœ¨ shared/
- ä¸šåŠ¡ä»£ç ç‹¬ç«‹åœ¨ modules/
- ä¸€çœ‹è·¯å¾„å°±çŸ¥é“æ˜¯ä»€ä¹ˆ
```

### 4. æ›´å¥½çš„å¤ç”¨
```typescript
// å…¶ä»–æ¨¡å—å¯ä»¥ç›´æ¥å¤ç”¨ shared ä¸­çš„ä»£ç 
import Logger from '@shared/utils/logger'
import { updateBlock } from '@shared/api'
```

---

## ğŸ” å¯¹æ¯”

### Beforeï¼ˆæ—§ç»“æ„ï¼‰âŒ
```
src/
â”œâ”€â”€ api.ts              # æ•£ä¹±
â”œâ”€â”€ components/         # ä¸çŸ¥é“æ˜¯é€šç”¨è¿˜æ˜¯ä¸šåŠ¡
â”œâ”€â”€ tag/                # å¥½ï¼ä½†å­¤ç«‹
â”œâ”€â”€ types/              # æ•£ä¹±
â””â”€â”€ utils/              # æ•£ä¹±
```

**é—®é¢˜ï¼š**
- âŒ é€šç”¨ä»£ç å’Œä¸šåŠ¡ä»£ç æ··åœ¨ä¸€èµ·
- âŒ ä¸æ¸…æ¥šå“ªäº›å¯ä»¥å¤ç”¨
- âŒ éš¾ä»¥æ‰©å±•æ–°åŠŸèƒ½æ¨¡å—

### Afterï¼ˆæ–°ç»“æ„ï¼‰âœ…
```
src/
â”œâ”€â”€ shared/             # æ¸…æ™°ï¼šé€šç”¨ä»£ç 
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ utils/
â”‚   â””â”€â”€ i18n/
â”‚
â””â”€â”€ modules/            # æ¸…æ™°ï¼šä¸šåŠ¡æ¨¡å—
    â””â”€â”€ tag/            # æ ‡ç­¾åŠŸèƒ½
```

**ä¼˜åŠ¿ï¼š**
- âœ… èŒè´£æ¸…æ™°
- âœ… æ˜“äºå¤ç”¨
- âœ… ä¾¿äºæ‰©å±•
- âœ… å¥½ç»´æŠ¤

---

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ é€šç”¨å·¥å…·

```typescript
// 1. åœ¨ shared/ ä¸‹åˆ›å»º
src/shared/utils/myUtil.ts

// 2. ä»»ä½•æ¨¡å—éƒ½å¯ä»¥ä½¿ç”¨
import { myUtil } from '@shared/utils/myUtil'
```

### æ·»åŠ æ–°ä¸šåŠ¡æ¨¡å—

```typescript
// 1. åœ¨ modules/ ä¸‹åˆ›å»ºæ–°ç›®å½•
src/modules/myFeature/
  â”œâ”€â”€ core/
  â”œâ”€â”€ ui/
  â”œâ”€â”€ utils/      // æ¨¡å—ä¸“ç”¨å·¥å…·
  â”œâ”€â”€ types/      // æ¨¡å—ä¸“ç”¨ç±»å‹
  â””â”€â”€ index.ts    // å¯¼å‡º

// 2. åœ¨ main.ts ä¸­å¼•å…¥
import { MyFeature } from '@modules/myFeature'
```

### æ¨¡å—é—´é€šä¿¡

```typescript
// é€šè¿‡ shared/ ä¸­çš„å·¥å…·è¿›è¡Œé€šä¿¡
import { EventBus } from '@shared/utils/eventBus'

// æˆ–è€…é€šè¿‡æ’ä»¶å®ä¾‹
import { usePlugin } from '@/main'
```

---

## âœ… éªŒè¯

### æ„å»ºæˆåŠŸ
```bash
npm run build
# âœ… æ„å»ºæˆåŠŸï¼Œæ— é”™è¯¯
# âœ… ç”Ÿæˆ package.zip
```

### åŠŸèƒ½å®Œæ•´
- âœ… æ ‡ç­¾æ·»åŠ åŠŸèƒ½æ­£å¸¸
- âœ… æ ‡ç­¾æœç´¢åŠŸèƒ½æ­£å¸¸
- âœ… äº‹ä»¶ç›‘å¬å™¨æ¸…ç†æ­£å¸¸
- âœ… æ‰€æœ‰é‡æ„çš„åŠŸèƒ½æ­£å¸¸

---

## ğŸ‰ æ€»ç»“

### æ”¹åŠ¨å½±å“
- âœ… **æœ€å°åŒ–** - åªç§»åŠ¨æ–‡ä»¶å’Œæ›´æ–°è·¯å¾„
- âœ… **å®‰å…¨** - ä¸šåŠ¡é€»è¾‘å®Œå…¨æœªåŠ¨
- âœ… **æˆåŠŸ** - æ„å»ºé€šè¿‡ï¼ŒåŠŸèƒ½æ­£å¸¸

### æ”¶ç›Š
- âœ… **æ›´æ¸…æ™°** - ä¸€ç›®äº†ç„¶çš„ç›®å½•ç»“æ„
- âœ… **æ›´æ˜“ç»´æŠ¤** - èŒè´£åˆ†æ˜
- âœ… **æ›´æ˜“æ‰©å±•** - æ–°å¢æ¨¡å—å¾ˆç®€å•
- âœ… **æ›´å¥½å¤ç”¨** - shared ç»Ÿä¸€ç®¡ç†

**é‡æ„å‰åå¯¹æ¯”ï¼š**
| æ–¹é¢ | é‡æ„å‰ | é‡æ„å |
|------|--------|--------|
| èŒè´£æ¸…æ™°åº¦ | â­â­ | â­â­â­â­â­ |
| å¯ç»´æŠ¤æ€§ | â­â­â­ | â­â­â­â­â­ |
| å¯æ‰©å±•æ€§ | â­â­ | â­â­â­â­â­ |
| ä»£ç å¤ç”¨ | â­â­ | â­â­â­â­â­ |

ğŸŠ **ç›®å½•ç»“æ„é‡æ„å®Œæˆï¼Œé¡¹ç›®æ›´ä¸“ä¸šäº†ï¼**

